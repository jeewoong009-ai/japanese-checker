<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>우리말 일본어 잔재 검사기</title>
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", sans-serif;
      color: #111827;
      background: #f3f4f6;
    }
    body {
      margin: 0;
      padding: 32px 16px;
      display: flex;
      justify-content: center;
    }
    .app {
      max-width: 1100px;
      width: 100%;
      background: #ffffff;
      border-radius: 20px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.12);
      padding: 24px 24px 28px;
    }
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 20px;
    }
    .app-title {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: -0.02em;
    }
    .app-sub {
      font-size: 0.9rem;
      color: #6b7280;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.75rem;
      background: #eef2ff;
      color: #4338ca;
      margin-left: 8px;
    }
    .layout {
      display: grid;
      grid-template-columns: 1.1fr 1.2fr 0.9fr;
      gap: 16px;
    }
    textarea {
      width: 100%;
      min-height: 240px;
      resize: vertical;
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      padding: 12px 14px;
      font-size: 0.95rem;
      line-height: 1.5;
      outline: none;
      transition: border-color .15s, box-shadow .15s;
    }
    textarea:focus {
      border-color: #4f46e5;
      box-shadow: 0 0 0 1px rgba(79,70,229,0.3);
    }
    .panel {
      background: #f9fafb;
      border-radius: 14px;
      padding: 12px 14px;
      border: 1px solid #e5e7eb;
      font-size: 0.93rem;
      line-height: 1.6;
      overflow-y: auto;
      max-height: 320px;
    }
    .panel-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: #6b7280;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      margin-bottom: 6px;
    }
    .button-row {
      margin-top: 8px;
      display: flex;
      gap: 8px;
    }
    button {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #4f46e5;
      color: white;
      box-shadow: 0 8px 18px rgba(79,70,229,0.3);
      transition: transform .08s, box-shadow .08s, background .15s;
    }
    button.secondary {
      background: #e5e7eb;
      color: #374151;
      box-shadow: none;
    }
    button:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(79,70,229,0.25);
    }
    .result-text {
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    mark.loanword {
      background: #fee2e2;
      border-radius: 4px;
      padding: 0 1px;
    }
    mark.translationese {
      background: #fef3c7;
      border-radius: 4px;
      padding: 0 1px;
    }
    mark.bureaucratese {
      background: #e0f2fe;
      border-radius: 4px;
      padding: 0 1px;
    }
    .legend {
      display: flex;
      gap: 8px;
      font-size: 0.8rem;
      margin-top: 4px;
    }
    .legend span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }
    .dot.lw { background: #fecaca; }
    .dot.tr { background: #fde68a; }
    .dot.bc { background: #bae6fd; }
    .item-list {
      list-style: none;
      padding: 0;
      margin: 4px 0 0;
    }
    .item {
      border-radius: 10px;
      padding: 6px 8px;
      margin-bottom: 4px;
      cursor: pointer;
      transition: background .1s;
      font-size: 0.9rem;
    }
    .item:hover {
      background: #e5e7eb;
    }
    .item.active {
      background: #e0e7ff;
    }
    .item span.type {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #6b7280;
      margin-right: 4px;
    }
    .item span.span {
      font-weight: 600;
    }
    .detail {
      margin-top: 8px;
      font-size: 0.9rem;
    }
    .detail h3 {
      margin: 0 0 4px;
      font-size: 0.95rem;
    }
    .detail .label {
      font-size: 0.75rem;
      text-transform: uppercase;
      color: #6b7280;
      letter-spacing: 0.06em;
      margin-top: 6px;
    }
    .muted {
      color: #9ca3af;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="app-header">
      <div>
        <div class="app-title">우리말 일본어 잔재 검사기</div>
        <div class="app-sub">
          일본어 기원어 · 일본식 번역투 · 행정체를 찾아 쉬운 우리말로 바꿔주는 학교 프로젝트용 도구
        </div>
      </div>
      <div class="pill">BETA · school project</div>
    </div>

    <div class="layout">
      <!-- 입력 영역 -->
      <div>
        <div class="panel-title">입력 텍스트</div>
        <textarea id="input"
          placeholder="검사할 글을 붙여넣으세요. 예) 이 사업을 실시함에 있어서 관련 규정을 준수하여야 한다."></textarea>
        <div class="button-row">
          <button id="runBtn">검사하기</button>
          <button id="clearBtn" class="secondary">지우기</button>
        </div>
      </div>

      <!-- 결과 텍스트 -->
      <div>
        <div class="panel-title">결과</div>
        <div id="result" class="panel">
          <div class="muted">
            왼쪽에 글을 입력하고 ‘검사하기’를 누르면, 여기에서 하이라이트된 결과를 볼 수 있습니다.
          </div>
        </div>
        <div class="legend">
          <span><span class="dot lw"></span>일본어 기원어</span>
          <span><span class="dot tr"></span>일본식 번역투</span>
          <span><span class="dot bc"></span>관청체/행정체</span>
        </div>
      </div>

      <!-- 항목 리스트 & 상세 -->
      <div>
        <div class="panel-title">발견된 표현</div>
        <div class="panel">
          <ul id="itemList" class="item-list"></ul>
          <div id="detail" class="detail muted">아직 분석 결과가 없습니다.</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const inputEl = document.getElementById('input');
    const runBtn = document.getElementById('runBtn');
    const clearBtn = document.getElementById('clearBtn');
    const resultEl = document.getElementById('result');
    const itemListEl = document.getElementById('itemList');
    const detailEl = document.getElementById('detail');

    let currentItems = [];

    clearBtn.onclick = () => {
      inputEl.value = '';
      currentItems = [];
      resultEl.innerHTML =
        '<div class="muted">왼쪽에 글을 입력하고 ‘검사하기’를 누르면, 여기에서 하이라이트된 결과를 볼 수 있습니다.</div>';
      itemListEl.innerHTML = '';
      detailEl.innerHTML = '<span class="muted">아직 분석 결과가 없습니다.</span>';
    };

    runBtn.onclick = async () => {
      const text = inputEl.value.trim();
      if (!text) {
        alert('먼저 글을 입력해 주세요.');
        return;
      }
      runBtn.disabled = true;
      runBtn.textContent = '검사 중...';

      try {
        const res = await fetch('/api/check', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });
        const data = await res.json();
        currentItems = data.items || [];
        renderResult(text, currentItems);
        renderList(currentItems);
      } catch (e) {
        console.error(e);
        alert('분석 중 오류가 발생했습니다.');
      } finally {
        runBtn.disabled = false;
        runBtn.textContent = '검사하기';
      }
    };

    function renderResult(text, items) {
      let html = text.replace(/[&<>]/g, s => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;' }[s]));
      const sorted = [...items].sort((a, b) => b.start - a.start);
      for (const it of sorted) {
        const cls = it.type;
        const before = html.slice(0, it.start);
        const mid = html.slice(it.start, it.end);
        const after = html.slice(it.end);
        html = `${before}<mark class="${cls}" data-span="${it.span}">${mid}</mark>${after}`;
      }
      resultEl.innerHTML = '<div class="result-text">' + html + '</div>';
    }

    function renderList(items) {
      if (!items.length) {
        itemListEl.innerHTML = '<li class="muted">발견된 표현이 없습니다.</li>';
        detailEl.innerHTML = '<span class="muted">아직 분석 결과가 없습니다.</span>';
        return;
      }
      itemListEl.innerHTML = '';
      items.forEach((it, idx) => {
        const li = document.createElement('li');
        li.className = 'item';
        li.innerHTML = `
          <span class="type">${it.type}</span>
          <span class="span">"${it.span}"</span>
        `;
        li.onclick = () => {
          document.querySelectorAll('.item').forEach(el => el.classList.remove('active'));
          li.classList.add('active');
          showDetail(it);
        };
        itemListEl.appendChild(li);
        if (idx === 0) showDetail(it);
      });
    }

    function showDetail(it) {
      detailEl.classList.remove('muted');
      detailEl.innerHTML = `
        <h3>"${it.span}"</h3>
        <div class="label">종류</div>
        <div>${labelType(it.type)} (confidence: ${(it.confidence ?? 0).toFixed(2)})</div>
        <div class="label">대체 표현</div>
        <div>${it.suggestion || '<span class="muted">제안 없음</span>'}</div>
        <div class="label">설명</div>
        <div>${it.note || '<span class="muted">설명 없음</span>'}</div>
      `;
    }

    function labelType(type) {
      if (type === 'loanword') return '일본어 기원어 (loanword)';
      if (type === 'translationese') return '일본식 번역투 (translationese)';
      if (type === 'bureaucratese') return '관청체/행정체 (bureaucratese)';
      return type;
    }
  </script>
</body>
</html>
